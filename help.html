<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Ayuda - Auto Par√°metros</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #1f2937;
      line-height: 1.6;
    }
    
    .help-container {
      max-width: 850px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .subtitle {
      color: #6b7280;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    h2 {
      color: #374151;
      margin-top: 30px;
      margin-bottom: 15px;
      font-size: 20px;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 8px;
    }
    
    h3 {
      color: #4b5563;
      margin-top: 20px;
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    p {
      margin-bottom: 15px;
      color: #4b5563;
    }
    
    ul {
      margin-left: 20px;
      margin-bottom: 15px;
    }
    
    li {
      margin-bottom: 8px;
      color: #4b5563;
    }
    
    .config-option {
      background: #f9fafb;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 4px;
    }
    
    .config-option strong {
      color: #667eea;
      display: block;
      margin-bottom: 5px;
    }
    
    .config-option.tracking {
      border-left-color: #f59e0b;
    }
    
    .config-option.tracking strong {
      color: #92400e;
    }
    
    .config-option.user {
      border-left-color: #0ea5e9;
    }
    
    .config-option.user strong {
      color: #0369a1;
    }
    
    .config-option.error {
      border-left-color: #ef4444;
    }
    
    .config-option.error strong {
      color: #991b1b;
    }
    
    .note {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .note strong {
      color: #92400e;
    }
    
    .tip {
      background: #d1fae5;
      border-left: 4px solid #10b981;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .tip strong {
      color: #065f46;
    }
    
    .credits {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 2px solid #e5e7eb;
      text-align: center;
      color: #6b7280;
    }
    
    .credits strong {
      color: #667eea;
      font-size: 18px;
    }
    
    .credits a {
      color: #667eea;
      text-decoration: none;
    }
    
    .credits a:hover {
      text-decoration: underline;
    }
    
    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #dc2626;
    }
    
    .btn-close {
      display: block;
      margin: 30px auto 0;
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
    }
    
    .btn-close:hover {
      background: #5568d3;
    }
    
    /* Tabla de contenidos */
    .toc {
      background: #f3f4f6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .toc h3 {
      margin-top: 0;
      color: #374151;
    }
    
    .toc ul {
      list-style: none;
      margin: 0;
    }
    
    .toc li {
      margin-bottom: 5px;
    }
    
    .toc a {
      color: #667eea;
      text-decoration: none;
    }
    
    .toc a:hover {
      text-decoration: underline;
    }
    /* Fin tabla de contenidos */
  </style>
</head>
<body>
  <div class="help-container">
    <h1>üìö Auto Par√°metros - Gu√≠a de Configuraci√≥n</h1>
    <p class="subtitle">Aprende c√≥mo configurar y utilizar la extensi√≥n de Auto Par√°metros para Tableau</p>
    
    <!-- Tabla de contenidos -->
    <div class="toc">
      <h3>Contenido</h3>
      <ul>
        <li><a href="#que-hace">¬øQu√© hace esta extensi√≥n?</a></li>
        <li><a href="#fuente-datos">1. Configurar Fuente de Datos</a></li>
        <li><a href="#identificacion">2. Identificaci√≥n de Usuario (Tracking)</a></li>
        <li><a href="#mapeo">3. Mapeo de Par√°metros</a></li>
        <li><a href="#comportamiento">4. Comportamiento</a></li>
        <li><a href="#error">5. Mensaje de Error</a></li>
        <li><a href="#tracking">6. Tracking de Accesos</a></li>
        <li><a href="#importar">7. Importar/Exportar Configuraci√≥n</a></li>
        <li><a href="#problemas">Soluci√≥n de Problemas</a></li>
      </ul>
    </div>
    
    <h2 id="que-hace">¬øQu√© hace esta extensi√≥n?</h2>
    <p>
      Auto Par√°metros permite cargar autom√°ticamente valores en los par√°metros de Tableau bas√°ndose en el usuario actual.
      La extensi√≥n lee datos de una fuente de datos (normalmente un Hyper) y configura m√∫ltiples par√°metros simult√°neamente.
    </p>
    <p>
      Adem√°s, registra cada acceso (exitoso o fallido) en un Google Sheet mediante un script de Google Apps Script,
      permiti√©ndote tener un log de qui√©n accede a cada dashboard y con qu√© rol.
    </p>
    
    <h2 id="fuente-datos">1. Configurar Fuente de Datos</h2>
    
    <div class="config-option">
      <strong>üìä Worksheet (Hoja) de Datos</strong>
      <p>Selecciona la hoja de Tableau que contiene la fuente de datos con la informaci√≥n de usuarios.</p>
      <p><em>Ejemplo:</em> Si tienes una hoja llamada "Usuarios Config", selecci√≥nala aqu√≠.</p>
    </div>
    
    <div class="config-option">
      <strong>üìä Fuente de Datos de Usuarios</strong>
      <p>Una vez seleccionada la hoja, elige la fuente de datos espec√≠fica (Hyper) que contiene los datos de usuarios.</p>
      <p><em>Ejemplo:</em> <code>HYPER_CONECTIVIDAD</code> o <code>usuarios.hyper</code></p>
    </div>
    
    <div class="config-option">
      <strong>üìä Columna de Username</strong>
      <p>Selecciona la columna que identifica al usuario actual. Normalmente es el campo de email.</p>
      <p><em>Ejemplo:</em> <code>EMAIL</code> o <code>USERNAME</code></p>
    </div>
    
    <h2 id="identificacion">2. Identificaci√≥n de Usuario (Tracking)</h2>
    
    <div class="config-option user">
      <strong>üë§ Nombre del Dashboard</strong>
      <p>Define un nombre para identificar este dashboard en los logs de tracking.</p>
      <p><em>Ejemplo:</em> "Dashboard de Ventas", "Reporte Financiero Q4"</p>
    </div>
    
    <div class="config-option user">
      <strong>üë§ Par√°metro de Usuario en Tableau</strong>
      <p>
        Selecciona el par√°metro de Tableau que contiene el email del usuario actual.
        Este par√°metro debe tener como valor por defecto la funci√≥n <code>USERNAME()</code>.
      </p>
    </div>
    
    <div class="tip">
      <strong>üí° C√≥mo crear el par√°metro de usuario:</strong>
      <ol style="margin-left: 20px; margin-top: 10px;">
        <li>En Tableau Desktop, ve a <strong>Datos ‚Üí Crear Par√°metro</strong></li>
        <li>Nombre: <code>CurrentUser</code> (o el nombre que prefieras)</li>
        <li>Tipo de datos: <strong>Cadena</strong></li>
        <li>Valor actual: escribe <code>USERNAME()</code></li>
        <li>Guarda el par√°metro</li>
      </ol>
      <p style="margin-top: 10px;">Este par√°metro capturar√° autom√°ticamente el email del usuario logueado en Tableau Server/Online.</p>
    </div>
    
    <h2 id="mapeo">3. Mapeo de Par√°metros</h2>
    <p>
      El mapeo conecta las columnas de tu fuente de datos con los par√°metros de Tableau.
      Para cada mapeo debes definir:
    </p>
    
    <div class="config-option">
      <strong>üîó Columna de Datos</strong>
      <p>La columna en tu fuente de datos que contiene el valor.</p>
      <p><em>Ejemplos:</em> <code>ROL</code>, <code>REGION</code>, <code>PAIS</code></p>
    </div>
    
    <div class="config-option">
      <strong>üîó Par√°metro de Tableau</strong>
      <p>El par√°metro de Tableau que recibir√° el valor de esa columna.</p>
      <p><em>Ejemplos:</em> <code>RolParametro</code>, <code>RegionParametro</code>, <code>PaisParametro</code></p>
    </div>
    
    <div class="note">
      <strong>‚ö†Ô∏è Importante:</strong> El primer mapeo es especial. El valor de ese par√°metro se usar√° como 
      "Status" en el tracking cuando el acceso sea exitoso. Por ejemplo, si mapeas ROL ‚Üí RolParametro, 
      el valor del rol se guardar√° en los logs.
    </div>
    
    <h2 id="comportamiento">4. Comportamiento</h2>
    
    <div class="config-option">
      <strong>‚öôÔ∏è Ocultar extensi√≥n despu√©s de cargar par√°metros</strong>
      <p>
        Si activas esta opci√≥n, la extensi√≥n se ocultar√° autom√°ticamente una vez que los par√°metros se carguen exitosamente.
        Esto mejora la experiencia del usuario final al no mostrar la interfaz de carga.
      </p>
      <p><strong>Nota:</strong> En modo editor, siempre podr√°s acceder a la configuraci√≥n desde el bot√≥n de engranaje.</p>
    </div>
    
    <h2 id="error">5. Mensaje de Error</h2>
    
    <div class="config-option error">
      <strong>‚ö†Ô∏è Mensaje personalizado</strong>
      <p>
        Define el mensaje que ver√°n los usuarios cuando no se encuentren sus datos o no tengan un rol asignado.
      </p>
      <p><em>Ejemplo:</em> "No se encontr√≥ tu usuario. Por favor contacta a soporte."</p>
    </div>
    
    <div class="config-option error">
      <strong>‚ö†Ô∏è URL del enlace</strong>
      <p>
        URL a la que se redirigir√° al usuario cuando haga click en el enlace del mensaje de error.
      </p>
      <p><em>Ejemplo:</em> <code>https://miempresa.atlassian.net/servicedesk/customer/portal/123</code></p>
    </div>
    
    <div class="config-option error">
      <strong>‚ö†Ô∏è Texto del enlace</strong>
      <p>
        El texto que se mostrar√° como enlace clickeable. Si lo dejas vac√≠o, se mostrar√° la URL completa.
      </p>
      <p><em>Ejemplos:</em> "Click Aqu√≠", "Crear Ticket", "Contactar Soporte"</p>
    </div>
    
    <h2 id="tracking">6. Tracking de Accesos</h2>
    
    <div class="config-option tracking">
      <strong>üìà URL del Script de Tracking</strong>
      <p>
        URL de tu Google Apps Script que registra los accesos en un Google Sheet.
        Deja vac√≠o para desactivar el tracking.
      </p>
      <p><em>Ejemplo:</em> <code>https://script.google.com/macros/s/AKfycb.../exec</code></p>
    </div>
    
    <div class="tip">
      <strong>üí° C√≥mo crear el script de tracking:</strong>
      <ol style="margin-left: 20px; margin-top: 10px;">
        <li>Crea un Google Sheet con las columnas: <code>EMAIL</code>, <code>DATE</code>, <code>DASHBOARD</code>, <code>STATUS</code></li>
        <li>Ve a <strong>Extensiones ‚Üí Apps Script</strong></li>
        <li>Pega este c√≥digo:
          <pre style="background: #1f2937; color: #e5e7eb; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 12px; overflow-x: auto;">
function doGet(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  sheet.appendRow([
    e.parameter.Email,
    e.parameter.Horario,
    e.parameter.Dashboard,
    e.parameter.Status
  ]);
  return ContentService.createTextOutput("OK");
}</pre>
        </li>
        <li>Implementa como "Aplicaci√≥n web" con acceso "Cualquier persona"</li>
        <li>Copia la URL y p√©gala en la configuraci√≥n</li>
      </ol>
    </div>
    
    <h2 id="importar">7. Importar/Exportar Configuraci√≥n</h2>
    
    <h3>Importar desde CSV</h3>
    <p>
      Puedes importar m√∫ltiples mapeos de una sola vez usando formato CSV:
    </p>
    <p><code>EMAIL,Usuario,ROL,RolParametro,REGION,RegionParametro</code></p>
    <p>El formato es: Columna1,Parametro1,Columna2,Parametro2,...</p>
    
    <h3>Exportar como CSV</h3>
    <p>
      Usa el bot√≥n "üìã Exportar CSV" para copiar tu configuraci√≥n actual al portapapeles.
      Esto es √∫til para respaldar o compartir tu configuraci√≥n con otros dashboards.
    </p>
    
    <h2 id="problemas">Soluci√≥n de Problemas</h2>
    
    <h3>La extensi√≥n no carga mis par√°metros</h3>
    <ul>
      <li>Verifica que la fuente de datos est√© correctamente conectada en el worksheet seleccionado</li>
      <li>Confirma que los nombres de las columnas y par√°metros sean exactos (distinguen may√∫sculas/min√∫sculas)</li>
      <li>Revisa los logs en la consola del navegador (F12) para ver mensajes de error espec√≠ficos</li>
    </ul>
    
    <h3>El tracking no registra el email del usuario</h3>
    <ul>
      <li>Aseg√∫rate de haber creado el par√°metro con <code>USERNAME()</code> como valor por defecto</li>
      <li>Selecciona ese par√°metro en "Par√°metro de Usuario en Tableau"</li>
      <li>Verifica que el script de Google tenga permisos de "Cualquier persona"</li>
    </ul>
    
    <h3>La extensi√≥n no se oculta despu√©s de cargar</h3>
    <ul>
      <li>Verifica que la opci√≥n "Ocultar extensi√≥n despu√©s de cargar" est√© marcada</li>
      <li>Aseg√∫rate de que el usuario tenga un rol v√°lido (no NULL o vac√≠o)</li>
      <li>Abre la consola del navegador (F12) para ver los logs detallados</li>
    </ul>
    
    <h3>Mensaje "No se encontr√≥ el Worksheet"</h3>
    <ul>
      <li>Verifica que el worksheet seleccionado a√∫n exista en el dashboard</li>
      <li>Si renombraste el worksheet, actualiza la configuraci√≥n</li>
    </ul>
    
    <div class="credits">
      <p><strong>Extensi√≥n creada por</strong></p>
      <p style="font-size: 20px; color: #374151; margin: 10px 0;">Andr√©s Canido</p>
      <p><a href="mailto:andres.canido@mercadolibre.com">andres.canido@mercadolibre.com</a></p>
      <p style="margin-top: 15px; font-size: 14px; color: #9ca3af;">
        ¬© 2025 - Auto Par√°metros para Tableau
      </p>
    </div>
    
    <button class="btn-close" onclick="window.close()">Cerrar Ayuda</button>
  </div>
</body>
</html>
